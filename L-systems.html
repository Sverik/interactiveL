<html>
<head>
<title>interactiveL</title>
<style>
.wrapper {float:left; }
</style>
<script src="Notation.js"></script>
<script src="RuleInput.js"></script>
<script src="DesignView.js"></script>
<script src="PreView.js"></script>
<script>

var system;
var design;
var previews = new Array();

var ruleInput0;

    window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       || 
              window.webkitRequestAnimationFrame || 
              window.mozRequestAnimationFrame    || 
              window.oRequestAnimationFrame      || 
              window.msRequestAnimationFrame     || 
              function( callback ){
                window.setTimeout(callback, 1000 / 60);
              };
    })();

function addPreview(iter) {
	var container = document.getElementById("previewContainer");
	var id = previews.length;
	var wrapperDiv = document.createElement('div');
	wrapperDiv.className = "wrapper";
	wrapperDiv.innerHTML =
		'<canvas id="preview_' + id + '" width="200" height="200" style="border:1px solid #aaaaaa;"></canvas>' +
		'<div id="info_' + id + '">_' + id + '</div>';
	container.appendChild(wrapperDiv);
	previews[id] = new PreView(
		document.getElementById('preview_' + id),
		document.getElementById('info_' + id),
		system, iter);
}

function onLoad() {
	var vertices = [];
	vertices.push(new Vertice(50, 20));
	vertices.push(new Vertice(150, 30));
	vertices.push(new Vertice(150, 130));
	vertices.push(new Vertice(70, 10));

	var lines = [];
	lines.push(new Line(vertices[0], vertices[1]));
	lines.push(new Line(vertices[1], vertices[2]));
	lines.push(new Line(vertices[1], vertices[3]));
	
	system = new System(document.getElementById("status"));
/*	// Dragon
	// AX
	system.setAxiom([Tokens.Z, Tokens.X]);
	// X=X+YA+
	system.setRule(Tokens.X, [
		Tokens.X,
		Tokens.LEFT,
		Tokens.Y,
		Tokens.Z,
		Tokens.RIGHT
	]);
	// Y=-AX-Y
	system.setRule(Tokens.Y, [
		Tokens.RIGHT,
		Tokens.Z,
		Tokens.X,
		Tokens.RIGHT,
		Tokens.Y
	]);
*/
/*
	// F
	system.setAxiom([Tokens.X]);
	// F+F-F-F+F
	system.setRule(Tokens.X, [
		Tokens.X,
		Tokens.LEFT,
		Tokens.X,
		Tokens.RIGHT,
		Tokens.X,
		Tokens.RIGHT,
		Tokens.X,
		Tokens.LEFT,
		Tokens.X
	]);
/**/
	system.setAxiom([Tokens.X, Tokens.LEFT, Tokens.X, Tokens.LEFT, Tokens.X, Tokens.LEFT, Tokens.X, Tokens.LEFT]);
	// F+F-F-F+F
	system.setRule(Tokens.X, [
		Tokens.X,
		Tokens.LEFT,
		Tokens.X,
		Tokens.RIGHT,
		Tokens.X
	]);


	design = new DesignView(document.getElementById("design"), vertices, lines, system);
	vertices = new Array();
	lines = new Array();

	addPreview(0);
	addPreview(1);
	addPreview(2);
	addPreview(4);
	addPreview(7);
	
	var container = document.getElementById("previewContainer");
	
	ruleInput0 = new RuleInput(document.getElementById("rule0"), system);
	// -X + X - X  - X + X
	
	frame();
}

function frame() {
	requestAnimFrame(frame);
	
	system.frame();
	design.frame();
	for (var i = 0 ; i < previews.length ; i++) {
		previews[i].frame();
	}

	ruleInput0.frame();
}

</script>
</head>
<body onLoad="onLoad()">
<p>
<canvas id="design" width="200" height="200" style="border:1px solid #aaaaaa;"></canvas>
<label for="rule0">X = <input id="rule0" type="text" size="20"></input></label>
</p>
<div style="float:left">
<p id="previewContainer">
</p>
<p>&nbsp;</p>
<div id="status"></div>
</div>

</body>
</html>