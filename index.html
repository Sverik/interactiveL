<html>
<head>
<title>interactiveL</title>
<style>
.wrapper {float:left; }
</style>
<script src="Notation.js"></script>
<script src="RuleInput.js"></script>
<script src="DesignView.js"></script>
<script src="PreView.js"></script>
<script>

var system;
var design;
var previews = new Array();

var ruleInputs = new Array();

    window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       || 
              window.webkitRequestAnimationFrame || 
              window.mozRequestAnimationFrame    || 
              window.oRequestAnimationFrame      || 
              window.msRequestAnimationFrame     || 
              function( callback ){
                window.setTimeout(callback, 1000 / 60);
              };
    })();

function addAxiomInput() {
	var container = document.getElementById("ruleContainer");
	var id = ruleInputs.length;
	var div = document.createElement('div');
	div.innerHTML = '<label for="rule_' + id + '">Axiom: <input id="rule_' + id + '" type="text" size="10"></input></label>';
	container.appendChild( div );
	
	ruleInputs[id] = new RuleInput(document.getElementById("rule_" + id), system,
		function( tokens ) {
			// setExpression
			system.setAxiom( tokens );
		},
		function() {
			// getExpression
			return system.axiom;
		});
}

function addRuleInput( token ) {
	var container = document.getElementById("ruleContainer");
	var id = ruleInputs.length;
	var div = document.createElement('div');
	div.innerHTML = '<label for="rule_' + id + '">' + getTokenChar(token) + ' = <input id="rule_' + id + '" type="text" size="20"></input></label>';
	container.appendChild( div );
	
	ruleInputs[id] = new RuleInput(document.getElementById("rule_" + id), system,
		function( tokens ) {
			// setExpression
			system.setRule( token, tokens );
		},
		function() {
			// getExpression
			return system.rules[token];
		});
}

function addPreview(iter) {
	var container = document.getElementById("previewContainer");
	var id = previews.length;
	var wrapperDiv = document.createElement('div');
	wrapperDiv.className = "wrapper";
	wrapperDiv.innerHTML =
		'<canvas id="preview_' + id + '" width="200" height="200" style="border:1px solid #aaaaaa;"></canvas>' +
		'<div id="info_' + id + '">_' + id + '</div>';
	container.appendChild(wrapperDiv);
	previews[id] = new PreView(
		document.getElementById('preview_' + id),
		document.getElementById('info_' + id),
		system, iter);
}

function onLoad() {
	var vertices = [];
	vertices.push(new Vertice(50, 20));
	vertices.push(new Vertice(150, 30));
	vertices.push(new Vertice(150, 130));
	vertices.push(new Vertice(70, 10));

	var lines = [];
	lines.push(new Line(vertices[0], vertices[1]));
	lines.push(new Line(vertices[1], vertices[2]));
	lines.push(new Line(vertices[1], vertices[3]));
	
	system = new System(document.getElementById("status"));

	system.setAxiom([Tokens.X]);
	system.setRule(Tokens.X, [
		Tokens.X,
		Tokens.LEFT,
		Tokens.X,
		Tokens.LEFT
	]);

	design = new DesignView(document.getElementById("design"), vertices, lines, system);
	vertices = new Array();
	lines = new Array();

	addAxiomInput();
	addRuleInput( Tokens.X );
	addRuleInput( Tokens.Y );
	addRuleInput( Tokens.Z );
	
	addPreview(0);
	addPreview(1);
	addPreview(2);
	addPreview(4);
	addPreview(7);
	addPreview(10);
	
	// -X + X - X  - X + X
	
	frame();
}

function frame() {
	requestAnimFrame(frame);
	
	system.frame();
	design.frame();

	for (var i = 0 ; i < previews.length ; i++) {
		previews[i].frame();
	}

	for (var i = 0 ; i < ruleInputs.length ; i++) {
		ruleInputs[i].frame();
	}
}

</script>
</head>
<body onLoad="onLoad()">
<canvas id="design" width="200" height="200" style="border:1px solid #aaaaaa;"></canvas>
<p id="ruleContainer"></p>
<div style="float:left">
	<p id="previewContainer"></p>
	<p>&nbsp;</p>
	<div id="status"></div>
</div>

<div height="300" style="position:absolute; bottom:0">
<a href="https://github.com/Sverik/interactiveL">code at GitHub</a>
</div>
</body>
</html>
